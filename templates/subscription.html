<!DOCTYPE html>
<html>
<head>
    <title>Push Notifications</title>
    <script>
        const publicKey = "YOUR_PUBLIC_KEY";

        async function subscribeUser() {
            if ("serviceWorker" in navigator) {
                const registration = await navigator.serviceWorker.register("/static/sw.js");
                const subscription = await registration.pushManager.subscribe({
                    userVisibleOnly: true,
                    applicationServerKey: urlBase64ToUint8Array(publicKey),
                });

                // Send subscription to the server
                await fetch("/subscribe", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify(subscription),
                });

                alert("User subscribed!");
            } else {
                alert("Push notifications are not supported in this browser.");
            }
        }

        function urlBase64ToUint8Array(base64String) {
            const padding = "=".repeat((4 - (base64String.length % 4)) % 4);
            const base64 = (base64String + padding).replace(/-/g, "+").replace(/_/g, "/");
            const rawData = window.atob(base64);
            return new Uint8Array([...rawData].map((char) => char.charCodeAt(0)));
        }
    </script>
</head>
<body>
    <h1>Push Notifications</h1>
    <button onclick="subscribeUser()">Subscribe</button>
</body>
</html>
